___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Shopify Webhook",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Assumes version \u003cpre\u003e2025-04\u003c/pre\u003e.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "requestPath",
    "displayName": "Request Path",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "help": "Set to the path you\u0027ll use for Shopify\u0027s webhooks. The default is \u003cstrong\u003e/swh\u003c/strong\u003e, which means that a request to \u003cstrong\u003ehttps://your-gtm-server.com/swh\u003c/strong\u003e will activate the Client. Note that tests assume the default.",
    "defaultValue": "/swh",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^/[^?#]*$"
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

// https://developers.google.com/tag-platform/tag-manager/server-side/api
// https://developers.google.com/tag-platform/tag-manager/templates/standard-library

const JSON = require("JSON");
const claimRequest = require("claimRequest");
const getRequestBody = require("getRequestBody");
const getRequestHeader = require("getRequestHeader");
const getRequestPath = require("getRequestPath");
const logToConsole = require("logToConsole");
const makeNumber = require("makeNumber");
const returnResponse = require("returnResponse");
const runContainer = require("runContainer");
const setResponseBody = require("setResponseBody");
const setResponseHeader = require("setResponseHeader");
const setResponseStatus = require("setResponseStatus");

function lineItemsToGA4Items(lineItems) {
  return lineItems.map((item, index) => ({
    affiliation: null,
    index: index,
    // item: item, // TODO Remove after debugging
    item_brand: item.vendor,
    item_category: null,
    item_category2: null,
    item_category3: null,
    item_category4: null,
    item_category5: null,
    item_id: item.product_id.toString(),
    item_name: item.title,
    item_type: null,
    item_variant: item.variant_title,
    item_variant_id: item.variant_id.toString(),
    item_variant_sku: item.sku,
    price: item.price_set.shop_money.amount,
    quantity: item.quantity,
  }));
}
const requestPath = getRequestPath();
if (requestPath === data.requestPath) {
  claimRequest();

  const requestBody = getRequestBody();
  logToConsole("requestBody =", requestBody);

  const shopify = JSON.parse(requestBody);
  logToConsole("shopify =", shopify);

  const shopifyNoteAttributes = shopify.note_attributes.reduce(
    (obj, item) => ((obj[item.name] = item.value), obj),
    {},
  );
  logToConsole("shopifyNoteAttributes =", shopifyNoteAttributes);

  let ga4 = {
    // shopify: shopify, // TODO Remove after debugging
  };
  let response = {};

  const shopifyTopic = getRequestHeader("X-Shopify-Topic");
  if (shopifyTopic === "orders/create") {
    ga4 = {
      checkout_token: shopify.checkout_token,
      client_id: shopifyNoteAttributes._cid || shopify.customer.id.toString(),
      coupon: shopify.discount_codes.map((code) => code.code).join(","),
      currency: shopify.current_total_price_set.shop_money.currency_code,
      event_id: shopify.id.toString(),
      event_name: "purchase",
      event_timestamp: shopify.created_at,
      fbclid: shopifyNoteAttributes._fbclid || undefined,
      ga_client_id: shopifyNoteAttributes._cid || undefined,
      ga_session_id: makeNumber(shopifyNoteAttributes._sid) || undefined,
      ga_session_number: makeNumber(shopifyNoteAttributes._sct) || undefined,
      gclid: shopifyNoteAttributes._gclid || undefined,
      items: lineItemsToGA4Items(shopify.line_items),
      page_location: shopify.order_status_url.split("?")[0],
      payment_type: shopify.payment_gateway_names.join(","),
      shipping: shopify.current_shipping_price_set.shop_money.amount,
      shipping_tier: shopify.shipping_lines.map((line) => line.title).join(","),
      shopify_client_id: shopifyNoteAttributes._shopify_y || undefined,
      shopify_event_name: shopifyTopic,
      shopify_session_id: shopifyNoteAttributes._shopify_s || undefined,
      subtotal: shopify.current_subtotal_price_set.shop_money.amount,
      tax: shopify.current_total_tax_set.shop_money.amount,
      transaction_id: shopify.id.toString(),
      user_data: {
        email: shopify.customer.email,
        phone_number: shopify.customer.phone,
      },
      user_id: shopify.customer.id.toString(),
      user_logged_in: shopify.customer.id ? true : false,
      value: shopify.current_total_price_set.shop_money.amount,
    };
    if (shopifyNoteAttributes.hasOwnProperty("_gclid")) {
      ga4.page_location =
        ga4.page_location + "?gclid=" + shopifyNoteAttributes._gclid;
      if (shopifyNoteAttributes.hasOwnProperty("_fbclid")) {
        ga4.page_location =
          ga4.page_location + "&fbclid=" + shopifyNoteAttributes._fbclid;
      }
    } else if (shopifyNoteAttributes.hasOwnProperty("_fbclid")) {
      ga4.page_location =
        ga4.page_location + "?fbclid=" + shopifyNoteAttributes._fbclid;
    }
    response.message = "forwarded `orders/create` as `purchase`";
  } else {
    response.message = "forwarded without event_name";
  }

  response.event = ga4;
  logToConsole("response =", response);

  const responseBody = JSON.stringify(response);
  setResponseBody(responseBody);
  setResponseHeader("Content-Type", "application/json");
  setResponseHeader("Content-Length", responseBody.length.toString());
  setResponseStatus(200);

  runContainer(ga4, () => returnResponse());
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "X-Shopify-Topic"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "bodyAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "pathAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "writeStatusAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "writeHeadersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "writeHeaderWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Content-Type"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "Content-Length"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "writeBodyAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "run_container",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: orders/create with test JSON
  code: |
    const JSON = require("JSON");

    mock("getRequestPath", () => {
      return "/swh";
    });

    mock("getRequestHeader", (header) => {
      if (header === "X-Shopify-Topic") {
        return "orders/create";
      }
    });

    mock("getRequestBody", () => {
      const body = {
        id: 820982911946154500,
        admin_graphql_api_id: "gid://shopify/Order/820982911946154508",
        app_id: null,
        browser_ip: null,
        buyer_accepts_marketing: true,
        cancel_reason: "customer",
        cancelled_at: "2025-04-03T08:42:11+02:00",
        cart_token: null,
        checkout_id: null,
        checkout_token: null,
        client_details: null,
        closed_at: null,
        company: null,
        confirmation_number: null,
        confirmed: false,
        contact_email: "jon@example.com",
        created_at: "2025-04-03T08:42:11+02:00",
        currency: "EUR",
        current_shipping_price_set: {
          shop_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
        },
        current_subtotal_price: "169.00",
        current_subtotal_price_set: {
          shop_money: {
            amount: "169.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "169.00",
            currency_code: "EUR",
          },
        },
        current_total_additional_fees_set: null,
        current_total_discounts: "0.00",
        current_total_discounts_set: {
          shop_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
        },
        current_total_duties_set: null,
        current_total_price: "169.00",
        current_total_price_set: {
          shop_money: {
            amount: "169.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "169.00",
            currency_code: "EUR",
          },
        },
        current_total_tax: "0.00",
        current_total_tax_set: {
          shop_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
        },
        customer_locale: "nl",
        device_id: null,
        discount_codes: [],
        duties_included: false,
        email: "jon@example.com",
        estimated_taxes: false,
        financial_status: "voided",
        fulfillment_status: null,
        landing_site: null,
        landing_site_ref: null,
        location_id: null,
        merchant_business_entity_id: "MTczMTkzODgxOTAz",
        merchant_of_record_app_id: null,
        name: "#9999",
        note: null,
        note_attributes: [],
        number: 234,
        order_number: 1234,
        order_status_url:
          "https://shadesbyerickuster.com/73193881903/orders/123456abcd/authenticate?key=abcd  efg",
        original_total_additional_fees_set: null,
        original_total_duties_set: null,
        payment_gateway_names: ["visa", "bogus"],
        phone: null,
        po_number: null,
        presentment_currency: "EUR",
        processed_at: "2025-04-03T08:42:11+02:00",
        reference: null,
        referring_site: null,
        source_identifier: null,
        source_name: "web",
        source_url: null,
        subtotal_price: "159.00",
        subtotal_price_set: {
          shop_money: {
            amount: "159.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "159.00",
            currency_code: "EUR",
          },
        },
        tags: "tag1, tag2",
        tax_exempt: false,
        tax_lines: [],
        taxes_included: false,
        test: true,
        token: "123456abcd",
        total_cash_rounding_payment_adjustment_set: {
          shop_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
        },
        total_cash_rounding_refund_adjustment_set: {
          shop_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
        },
        total_discounts: "20.00",
        total_discounts_set: {
          shop_money: {
            amount: "20.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "20.00",
            currency_code: "EUR",
          },
        },
        total_line_items_price: "169.00",
        total_line_items_price_set: {
          shop_money: {
            amount: "169.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "169.00",
            currency_code: "EUR",
          },
        },
        total_outstanding: "169.00",
        total_price: "159.00",
        total_price_set: {
          shop_money: {
            amount: "159.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "159.00",
            currency_code: "EUR",
          },
        },
        total_shipping_price_set: {
          shop_money: {
            amount: "10.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "10.00",
            currency_code: "EUR",
          },
        },
        total_tax: "0.00",
        total_tax_set: {
          shop_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
          presentment_money: {
            amount: "0.00",
            currency_code: "EUR",
          },
        },
        total_tip_received: "0.00",
        total_weight: 0,
        updated_at: "2025-04-03T08:42:11+02:00",
        user_id: null,
        billing_address: {
          first_name: "Jan",
          address1: "Vruchtengaard 51",
          phone: "555-555-SHIP",
          city: "Doorn",
          zip: "3941 LG",
          province: "Utrecht",
          country: "Nederland",
          last_name: "Smit",
          address2: null,
          company: "Shipping Bedrijf",
          latitude: null,
          longitude: null,
          name: "Jan Smit",
          country_code: null,
          province_code: null,
        },
        customer: {
          id: 115310627314723950,
          email: "john@example.com",
          created_at: null,
          updated_at: null,
          first_name: "Jan",
          last_name: "Smit",
          state: "disabled",
          note: null,
          verified_email: true,
          multipass_identifier: null,
          tax_exempt: false,
          phone: null,
          currency: "EUR",
          tax_exemptions: [],
          admin_graphql_api_id: "gid://shopify/Customer/115310627314723954",
          default_address: {
            id: 715243470612851200,
            customer_id: 115310627314723950,
            first_name: null,
            last_name: null,
            company: null,
            address1: "123 Elm St.",
            address2: null,
            city: "Ottawa",
            province: "Ontario",
            country: "Canada",
            zip: "K2H7A8",
            phone: "123-123-1234",
            name: "",
            province_code: "ON",
            country_code: "CA",
            country_name: "Canada",
            default: true,
          },
        },
        discount_applications: [],
        fulfillments: [],
        line_items: [
          {
            id: 866550311766439000,
            admin_graphql_api_id: "gid://shopify/LineItem/866550311766439020",
            attributed_staffs: [
              {
                id: "gid://shopify/StaffMember/902541635",
                quantity: 1,
              },
            ],
            current_quantity: 1,
            fulfillable_quantity: 1,
            fulfillment_service: "manual",
            fulfillment_status: null,
            gift_card: false,
            grams: 0,
            name: "Dune muurverf",
            price: "29.00",
            price_set: {
              shop_money: {
                amount: "29.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "29.00",
                currency_code: "EUR",
              },
            },
            product_exists: true,
            product_id: 8142655586607,
            properties: [],
            quantity: 1,
            requires_shipping: true,
            sales_line_item_group_id: null,
            sku: "8721042355331",
            taxable: true,
            title: "Dune muurverf",
            total_discount: "0.00",
            total_discount_set: {
              shop_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
            },
            variant_id: 48539281359172,
            variant_inventory_management: "shopify",
            variant_title: null,
            vendor: null,
            tax_lines: [],
            duties: [],
            discount_allocations: [],
          },
          {
            id: 141249953214522980,
            admin_graphql_api_id: "gid://shopify/LineItem/141249953214522974",
            attributed_staffs: [],
            current_quantity: 1,
            fulfillable_quantity: 1,
            fulfillment_service: "manual",
            fulfillment_status: null,
            gift_card: false,
            grams: 0,
            name: "Dune lak",
            price: "65.00",
            price_set: {
              shop_money: {
                amount: "65.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "65.00",
                currency_code: "EUR",
              },
            },
            product_exists: true,
            product_id: 8144196239663,
            properties: [],
            quantity: 1,
            requires_shipping: true,
            sales_line_item_group_id: 142831562,
            sku: "8720254492414",
            taxable: true,
            title: "Dune lak",
            total_discount: "0.00",
            total_discount_set: {
              shop_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
            },
            variant_id: 44590003618095,
            variant_inventory_management: "shopify",
            variant_title: null,
            vendor: null,
            tax_lines: [],
            duties: [],
            discount_allocations: [],
          },
          {
            id: 257004973105704600,
            admin_graphql_api_id: "gid://shopify/LineItem/257004973105704598",
            attributed_staffs: [],
            current_quantity: 1,
            fulfillable_quantity: 1,
            fulfillment_service: "manual",
            fulfillment_status: null,
            gift_card: false,
            grams: 0,
            name: "Dune muur primer",
            price: "75.00",
            price_set: {
              shop_money: {
                amount: "75.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "75.00",
                currency_code: "EUR",
              },
            },
            product_exists: true,
            product_id: 8144196698415,
            properties: [],
            quantity: 1,
            requires_shipping: true,
            sales_line_item_group_id: 142831562,
            sku: "8720256791546",
            taxable: true,
            title: "Dune muur primer",
            total_discount: "0.00",
            total_discount_set: {
              shop_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
            },
            variant_id: 44590009712943,
            variant_inventory_management: "shopify",
            variant_title: null,
            vendor: null,
            tax_lines: [],
            duties: [],
            discount_allocations: [],
          },
        ],
        payment_terms: null,
        refunds: [],
        shipping_address: {
          first_name: "Jan",
          address1: "Vruchtengaard 51",
          phone: "555-555-SHIP",
          city: "Doorn",
          zip: "3941 LG",
          province: "Utrecht",
          country: "Nederland",
          last_name: "Smit",
          address2: null,
          company: "Shipping Bedrijf",
          latitude: null,
          longitude: null,
          name: "Jan Smit",
          country_code: null,
          province_code: null,
        },
        shipping_lines: [
          {
            id: 271878346596884000,
            carrier_identifier: null,
            code: null,
            current_discounted_price_set: {
              shop_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "0.00",
                currency_code: "EUR",
              },
            },
            discounted_price: "10.00",
            discounted_price_set: {
              shop_money: {
                amount: "10.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "10.00",
                currency_code: "EUR",
              },
            },
            is_removed: false,
            phone: null,
            price: "10.00",
            price_set: {
              shop_money: {
                amount: "10.00",
                currency_code: "EUR",
              },
              presentment_money: {
                amount: "10.00",
                currency_code: "EUR",
              },
            },
            requested_fulfillment_service_id: null,
            source: "shopify",
            title: "Generic Shipping",
            tax_lines: [],
            discount_allocations: [],
          },
        ],
        returns: [],
      };
      return JSON.stringify(body);
    });

    runCode();
setup: ''


___NOTES___

Created on 5/6/2025, 3:39:04 PM


